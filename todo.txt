refactor secondary index generation: use new cursor tool

implement filter